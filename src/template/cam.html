{% extends 'main.html' %}
{% load static %}

{% block title %}
    R.O.D - CAM REGISTER
{% endblock %}

{% block content %}
    <section class="pt-2 pb-0 mb-0">
        <hr class="text-light">
        <div class="container-fluid pb-0 mb-0">
            <div class="row">
                <div class="col-md-6 col-sm-12 px-2">
                    <h4 class="text-light pb-1">Register Your IP Camera</h4>
                    {% if messages %}
                        {% for message in messages %}
                            {% if message.tags == 'error' %}
                            <div class="float-left alert alert-danger alert-dismissible fade show" role="alert">
                            {% else %}
                            <div class="float-left alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {% endif %}
                        
                            {{ message | safe }} {{ message.tags }}
                            <button type="button" class="close btn-close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true"></span>
                            </button>
                        </div>
                        {% endfor %}
                    {% endif %}
                    <form method="post" id="camRegForm">
                        {% csrf_token %}
                        <div class="form-row align-items-center">
                            <div class="col-auto">
                                <div class="input-group mb-2">
                                    <div class="input-group-prepend">
                                    <div class="input-group-text">@</div>
                                    </div>
                                    {{ form.cname }}
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="d-flex py-2 px-0 mx-0 gap-3" style="margin-left: 0%;">
                                    {{ form.cip }}
                                    {{ form.cport }}
                                </div>
                            </div>
                            <div class="col-auto text-end">
                                <button type="submit" id="regBtn" class="btn btn-primary mb-2" disabled="true">Register</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-md-6 col-sm-12 px-2">
                    <h4 class="text-light pb-1">Registered IP Cameras</h4>
                    <div class="overflow-auto" style="height: 200px;">
                        <table class="table table-dark">
                            <thead>
                              <tr>
                                <th scope="col">CAM</th>
                                <th scope="col">CAM IP</th>
                                <th scope="col">CAM PORT</th>
                                <th scope="col">STATUS</th>
                                <th scope="col">ACTION</th>
                              </tr>
                            </thead>
                            <tbody>
                                {% if cameras %}
                                    {% for camera in cameras %}
                                        <tr data-camera-name="{{ camera.cname }}" data-camera-ip="{{ camera.cip }}" data-camera-port="{{ camera.cport }}">
                                            <td>{{ camera.cname }}</td>
                                            <td>{{ camera.cip }}</td>
                                            <td>{{ camera.cport }}</td>
                                            <td>{{ camera.selected }}</td>
                                            <td>
                                                <a href="" class="test-link">Test</a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr data-camera-name="Camera 1" data-camera-ip="198.108.0.107" data-camera-port="8080">
                                        <td>--</td>
                                        <td>--</td>
                                        <td>--</td>
                                        <td>--</td>
                                        <td>--</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section>
        <hr class="text-light">
        <div class="row" style="width: 100%;">
            <div class="col-md-1"></div>
            <div class="col-md-6 col-sm-12 sm-mb-5">
                <img id="video_stream" class="img-fluid rounded px-5 border border-5 border-secondary" hidden="true">
                <img src="{% static '\asset\images\no_camera.jpg' %}" id="video_stream_placeholder" class="img-fluid rounded px-5 border border-5 border-secondary" alt="camera feed">
            </div>
            <div class="col-md-4 col-sm-12 pb-0">
                <div class="card bg-secondary py-1">
                    <div class="card-header text-light">
                        <div class="d-flex" style="justify-content: space-between;">
                            <p class="text-left">CAMERA TESTING</p>
                            <a class="text-light" id="text-web-cam" href="!#"> Test WebCam ?</a>
                        </div>
                    </div>
                    <div class="card-body text-light justify-content-center">
                        <div class="row py-4">
                            <div class="col-md-6 col-sm-4 py-2">
                                <p>Camera Name: <span id="camera-name"> -- </span></p>
                                <p>Camera IP: <span id="camera-ip"> -- </span></p>
                                <p>Camera Port: <span id="camera-port"> -- </span></p>
                                <div class="text-center">
                                    <button id="stopBtn" class="btn btn-danger mx-5 px-5 mt-2" disabled="true">Stop</button>
                                </div>
                                
                            </div>
                            <div class="col-md-6 col-sm-8 py-3">
                                <img src="{% static '\asset\images\testing.gif' %}" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-1"></div>
        </div>
    </section>
    <section>
        <img src="" alt="" id="new_img">
    </section>
{% endblock content %}

{% block extra_js %}
<script src="{% static 'js/cam.js' %}"></script>
{% endblock extra_js %}
